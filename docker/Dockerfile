# Use Debian bullseye-slim as the base image for newer OpenSSL
FROM ubuntu:24.04
ARG CRATE_VERSION

# Set maintainer metadata
LABEL maintainer="rustmailer <rustmailer.git@gmail.com>"
LABEL version="${CRATE_VERSION}"
LABEL description="Dockerized RustMailer service"

# Set working directory
WORKDIR /opt/rustmailer

# Copy compiled binary (ensure it's statically linked or compatible with bullseye)
COPY rustmailer /opt/rustmailer/rustmailer
COPY LICENSE /opt/rustmailer/
COPY license.html /opt/rustmailer/
# Set proper permissions
RUN chmod +x /opt/rustmailer/rustmailer

# Create data directory
RUN mkdir -p /data

# Expose default ports
EXPOSE 15630 16630

# Set volume and working directory
WORKDIR /data

HEALTHCHECK --interval=30s --timeout=5s --start-period=5s --retries=3 \
  CMD curl -fs http://localhost:15630/api/status || exit 1

# Entrypoint remains the binary
CMD ["/opt/rustmailer/rustmailer"]
